{% extends "base.html" %}
{% load static %}

{% block page_header %}
    <!-- Add any header content here if needed -->
{% endblock %}

{% block extra-nav %}
    {% include 'includes/vendor-navbar.html' %}
{% endblock %}

{% block content %}
<div class="row mt-1 mb-2">
    
    <div class="col-12">
        <p class="text-muted mt-3 text-center">
            Order Details
        </p>
    </div>
</div>
<div>
    </div>
    <div class="table-responsive">
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th scope="col">Order No</th>
                    <th scope="col">Product/Address</th>
                    <th scope="col">Qty</th>
                    <th scope="col">Amount</th>
                    {% if request.user.is_staff %}
                    <th scope="col">Accept?</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                    <tr>
                        <td>{{ order.order }}</td>
                        <td>{{ order.product }}
                            | {{ order.full_name }}
                            {{ order.order.street_address1 }},
                            {{ order.order.street_address2 }}, 
                            {{ order.order.town_or_city }},
                            {{ order.order.county }},
                            {{ order.order.country }}.
                        </td>
                        <td>{{ order.quantity }}</td>
                        <td>{{ order.lineitem_total }}</td>
                        {% if request.user.is_staff %}
                        <td>Accepted</td>
                        {% endif %}
                    </tr>
            </tbody>
        </table>
        <div>
            <form method="POST">
                {% csrf_token %}
                {{ form|crispy }}
                <button type="submit">Update Status</button>
              </form>
        </div>
    </div>
    
</div>
</div>
<div class="top-down-button shadow-sm rounded-0 border border-body">
    <a class="top-down-link d-flex h-100">
        <i class="fas fa-arrow-up text-body mx-auto my-auto"></i>
    </a>	
</div>

    <!-- Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Delete</h5>
          <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete this product?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
        </div>
      </div>
    </div>
  </div>
  
    
    <script type="text/javascript">
		$('.top-down-link').click(function(e) {
			window.scrollTo(0,0)
		})
	</script>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var conditionValue = {{ condition_value }};
            var statusField = document.getElementById("id_status");
            var options = statusField.options;
            
            for (var i = 0; i < options.length; i++) {
                if (parseInt(options[i].value) <= conditionValue) {
                    options[i].disabled = true;
                }
            }
        });
    </script>
    
    <script type="text/javascript">
        $('#sort-selector').change(function() {
            var selector = $(this);
            var currentUrl = new URL(window.location);

            var selectedVal = selector.val();
            if(selectedVal != "reset"){
                var sort = selectedVal.split("_")[0];
                var direction = selectedVal.split("_")[1];

                currentUrl.searchParams.set("sort", sort);
                currentUrl.searchParams.set("direction", direction);

                window.location.replace(currentUrl);
            } else {
                currentUrl.searchParams.delete("sort");
                currentUrl.searchParams.delete("direction");

                window.location.replace(currentUrl);
            }
        })
    </script>

<script>
    // Handle click event on Delete button in modal
    $(document).ready(function() {
        $('#confirmDeleteBtn').on('click', function() {
            // Show confirmation dialog
            $('#confirmDeleteModal').modal('hide'); // Hide the confirmation modal
            var productId = $(this).data('product-id'); // Get the product ID from data attribute
            var deleteUrl = "{% url 'delete_product' product_id=0 %}".replace('0', productId); // Generate delete URL
            window.location.href = deleteUrl; // Redirect to delete URL
        });
    });

    // Show confirmation modal when delete button is clicked
    $('.delete-btn').on('click', function() {
        var productId = $(this).data('product-id'); // Get the product ID from data attribute
        $('#confirmDeleteModal').modal('show'); // Show the confirmation modal
        $('#confirmDeleteBtn').data('product-id', productId); // Set the product ID to data attribute of the delete button
    });
</script>
{% endblock %}